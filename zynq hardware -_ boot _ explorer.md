                                      var NexT = window.NexT || {}; var CONFIG = { root: '/', scheme: 'Gemini', version: '5.1.4', sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false}, fancybox: true, tabs: true, motion: {"enable":true,"async":false,"transition":{"post\_block":"fadeIn","post\_header":"slideDownIn","post\_body":"slideDownIn","coll\_header":"slideLeftIn","sidebar":"slideUpIn"}}, duoshuo: { userId: '0', author: 'Author' }, algolia: { applicationID: '', apiKey: '', indexName: '', hits: {"per\_page":10}, labels: {"input\_placeholder":"Search for Posts","hits\_empty":"We didn't find any results for the search: ${query}","hits\_stats":"${hits} results found in ${time} ms"} } };  zynq hardware -> boot | explorer  (function(i,s,o,g,r,a,m){i\['GoogleAnalyticsObject'\]=r;i\[r\]=i\[r\]||function(){ (i\[r\].q=i\[r\].q||\[\]).push(arguments)},i\[r\].l=1\*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)\[0\];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', '112423075-1', 'auto'); ga('send', 'pageview');   var \_hmt = \_hmt || \[\]; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?2ab4cc06d0da36106a4426465d0cb00d"; var s = document.getElementsByTagName("script")\[0\]; s.parentNode.insertBefore(hm, s); })();  .v \*{-webkit-box-sizing:border-box;box-sizing:border-box;line-height:2;color:#555;-webkit-transition:all .3s ease;transition:all .3s ease}.v hr{margin:.825rem 0;border-color:#f6f6f6;border-style:dashed}.v.hide-avatar .vimg{display:none}.v a{position:relative;cursor:pointer;color:#1abc9c;display:inline-block}.v a:before{content:"";position:absolute;width:0;right:0;bottom:0;height:1px;background:#1abc9c;-webkit-transition:width .3s ease;transition:width .3s ease}.v a:hover{color:#d7191a}.v a:hover:before{width:100%;left:0;right:auto}.v code,.v pre{background-color:#f6f6f6;color:#555;padding:.2em .4em;border-radius:3px;font-size:85%;margin:0;font-family:Source Code Pro,courier new,Input Mono,PT Mono,SFMono-Regular,Consolas,Monaco,Menlo,PingFang SC,Liberation Mono,Microsoft YaHei,Courier，monospace}.v pre{padding:10px;overflow:auto;line-height:1.45}.v pre code{padding:0;background:transparent;white-space:pre-wrap;word-break:keep-all}.v blockquote{color:#666;margin:.5rem 0;padding:0 0 0 1rem;border-left:8px solid hsla(0,0%,93%,.5)}.v .vinput{border:none;resize:none;outline:none;padding:10px 5px;max-width:100%;font-size:.775rem}.v input\[type=checkbox\],.v input\[type=radio\]{display:inline-block;vertical-align:middle;margin-top:-2px}.v .vwrap{border:1px solid #f0f0f0;border-radius:4px;margin-bottom:10px;overflow:hidden;position:relative;padding:10px}.v .vwrap input{background:transparent}.v .vwrap .vedit{position:relative;padding-top:10px}.v .vwrap .vedit .vctrl{text-align:right;font-size:12px}.v .vwrap .vedit .vctrl span{padding:10px;display:inline-block;vertical-align:middle;cursor:pointer}.v .vwrap .vedit .vemojis{display:none;font-size:18px;text-align:justify;max-height:145px;overflow:auto;margin-bottom:10px;-webkit-box-shadow:0 0 1px #f0f0f0;box-shadow:0 0 1px #f0f0f0}.v .vwrap .vedit .vemojis i{font-style:normal;padding:7px 0;width:38px;cursor:pointer;text-align:center;display:inline-block;vertical-align:middle}.v .vwrap .vedit .vpreview{padding:7px;-webkit-box-shadow:0 0 1px #f0f0f0;box-shadow:0 0 1px #f0f0f0}.v .vwrap .vedit .vpreview frame,.v .vwrap .vedit .vpreview iframe,.v .vwrap .vedit .vpreview img{max-width:100%;border:none}.v .vwrap .vheader .vinput{width:33.33%;border-bottom:1px dashed #dedede}.v .vwrap .vheader.item2 .vinput{width:50%}.v .vwrap .vheader.item1 .vinput{width:100%}.v .vwrap .vheader .vinput:focus{border-bottom-color:#eb5055}@media screen and (max-width:520px){.v .vwrap .vheader.item2 .vinput,.v .vwrap .vheader .vinput{width:100%}}.v .vwrap .vcontrol{font-size:0;padding-top:15px}.v .vwrap .vcontrol .col{display:inline-block;font-size:.725rem;vertical-align:middle;color:#ccc}.v .vwrap .vcontrol .col.text-right{text-align:right}.v .vwrap .vcontrol .col svg{margin-right:2px;overflow:hidden;fill:currentColor;vertical-align:middle}.v .vwrap .vcontrol .col.col-20{width:20%}.v .vwrap .vcontrol .col.col-40{width:40%}.v .vwrap .vcontrol .col.col-60{width:60%}.v .vwrap .vcontrol .col.col-80{width:80%}.v .vwrap .vcontrol .col.split{width:50%}.v .vwrap .vmark{position:absolute;background:rgba(0,0,0,.65);width:100%;height:100%;left:0;top:0}.v .vwrap .vmark .valert{padding-top:3rem}.v .vwrap .vmark .valert .vtext{color:#fff;padding:1rem 0}.v .vwrap .vmark .valert .vcode{width:4.6875rem;border-radius:.3125rem;padding:.5rem;background:#dedede}.v .vwrap .vmark .valert .vcode:focus{border-color:#3090e4;background-color:#fff}@media screen and (max-width:720px){.v .vwrap .vmark .valert{padding-top:5.5rem}.v .vwrap .vmark .valert .vtext{color:#fff;padding:1rem 0}}.v .power{color:#999;padding:.5rem 0}.v .power,.v .power a{font-size:.75rem}.v .vinfo{font-size:0;padding:5px}.v .vinfo .col{font-size:.875rem;display:inline-block;width:50%;vertical-align:middle}.v .vinfo .vcount .vnum{font-weight:600;font-size:1.25rem}.v a{text-decoration:none;color:#555}.v a:hover{color:#222}.v ol,.v ul{padding:0;margin-left:1.25rem}.v .txt-center{text-align:center}.v .txt-right{text-align:right}.v .pd5{padding:5px}.v .pd10{padding:10px}.v .veditor{width:100%;min-height:8.75rem;font-size:.875rem;background:transparent;resize:vertical;-webkit-transition:all .25s ease;transition:all .25s ease}.v .vbtn{-webkit-transition-duration:.4s;transition-duration:.4s;text-align:center;color:#313131;border:1px solid #ededed;border-radius:.3rem;display:inline-block;background:#ededed;margin-bottom:0;font-weight:400;vertical-align:middle;-ms-touch-action:manipulation;touch-action:manipulation;cursor:pointer;white-space:nowrap;padding:.5rem 1.25rem;font-size:.875rem;line-height:1.42857143;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;outline:none}.v .vbtn+.vbtn{margin-left:1.25rem}.v .vbtn:active,.v .vbtn:hover{color:#3090e4;border-color:#3090e4;background-color:#fff}.v .vempty{padding:1.25rem;text-align:center;color:#999}.v .vlist{width:100%}.v .vlist .vcard{padding-top:1.5rem;position:relative;display:block}.v .vlist .vcard:after{content:"";clear:both;display:block}.v .vlist .vcard .vimg{width:3.125rem;height:3.125rem;float:left;border-radius:50%;margin-right:.7525rem;border:1px solid #f5f5f5;padding:.125rem}@media screen and (max-width:720px){.v .vlist .vcard .vimg{width:2.5rem;height:2.5rem}}.v .vlist .vcard .vhead{line-height:1.5;margin-top:0}.v .vlist .vcard .vhead .vnick{position:relative;font-size:.875rem;font-weight:500;margin-right:.875rem;cursor:pointer;color:#1abc9c;text-decoration:none;display:inline-block}.v .vlist .vcard .vhead .vnick:before{content:"";position:absolute;width:0;right:0;bottom:0;height:1px;background:#1abc9c;-webkit-transition:width .3s ease;transition:width .3s ease}.v .vlist .vcard .vhead .vnick:hover{color:#d7191a}.v .vlist .vcard .vhead .vnick:hover:before{width:100%;left:0;right:auto}.v .vlist .vcard .vhead .vsys{display:inline-block;padding:.2rem .5rem;background:#ededed;color:#b3b1b1;font-size:.75rem;border-radius:.2rem;margin-right:.3rem}@media screen and (max-width:520px){.v .vlist .vcard .vhead .vsys{display:none}}.v .vlist .vcard .vh{overflow:hidden;padding-bottom:.5rem;border-bottom:1px dashed #f5f5f5}.v .vlist .vcard .vh .vtime{color:#b3b3b3;font-size:.75rem;margin-right:.875rem}.v .vlist .vcard .vh .vmeta{line-height:1;position:relative}.v .vlist .vcard .vh .vmeta .vat{font-size:.8125rem;color:#ef2f11;cursor:pointer;float:right}.v .vlist .vcard .vcontent{word-wrap:break-word;word-break:break-all;text-align:justify;color:#4a4a4a;font-size:.875rem;line-height:2;position:relative;margin-bottom:.75rem;padding-top:.625rem}.v .vlist .vcard .vcontent frame,.v .vlist .vcard .vcontent iframe,.v .vlist .vcard .vcontent img{max-width:100%;border:none}.v .vlist .vcard .vcontent.expand{cursor:pointer;max-height:11.25rem;overflow:hidden}.v .vlist .vcard .vcontent.expand:before{display:block;content:"";position:absolute;width:100%;left:0;top:0;bottom:3.15rem;pointer-events:none;background:-webkit-gradient(linear,left top,left bottom,from(hsla(0,0%,100%,0)),to(hsla(0,0%,100%,.9)));background:linear-gradient(180deg,hsla(0,0%,100%,0),hsla(0,0%,100%,.9))}.v .vlist .vcard .vcontent.expand:after{display:block;content:"Click on expand";text-align:center;color:#828586;position:absolute;width:100%;height:3.15rem;line-height:3.15rem;left:0;bottom:0;pointer-events:none;background:hsla(0,0%,100%,.9)}.v .vlist .vcard .vquote{color:#666;margin-top:1rem;padding-left:1rem;border-left:1px dashed hsla(0,0%,93%,.5)}.v .vlist .vcard .vquote .vimg{width:2.225rem;height:2.225rem}.v .vpage .vmore{margin:1rem 0}.v .clear{content:"";display:block;clear:both}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@-webkit-keyframes pulse{50%{background:#dcdcdc}}@keyframes pulse{50%{background:#dcdcdc}}.v .vloading{position:relative;padding:20px;display:block;height:80px}.v .vloading:before{-webkit-box-sizing:border-box;box-sizing:border-box;content:"";position:absolute;display:inline-block;top:20px;left:50%;margin-left:-20px;width:40px;height:40px;border:6px double #a0a0a0;border-top-color:transparent;border-bottom-color:transparent;border-radius:50%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.fancybox-margin{margin-right:17px;}

[explorer](http://kcmetercec.top/)

万丈高楼平地起，勿在浮沙筑高台

*   [  
    Home](http://kcmetercec.top/)
*   [  
    About](http://kcmetercec.top/about/)
*   [  
    Tags](http://kcmetercec.top/tags/)
*   [  
    Categories](http://kcmetercec.top/categories/)
*   [  
    Archives](http://kcmetercec.top/archives/)
*   [  
    Search](javascript:;)

       

zynq hardware -> boot
=====================

Posted on 2018-11-08 | In [processor](http://kcmetercec.top/categories/processor/) , [zynq](http://kcmetercec.top/categories/processor/zynq/) , [hardware](http://kcmetercec.top/categories/processor/zynq/hardware/) | [0](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#comments) | Visitors: 34

整理zynq的硬件启动流程。

整体流程
----

### 概览

zynq的整体启动流程如下图:

[![boot.jpg](./zynq hardware -_ boot _ explorer_files/boot.jpg)](./zynq hardware -_ boot _ explorer_files/boot.jpg)

*   除了以上的启动方式外，在调试阶段，可以通过JTAG接口以非安全模式下启动。
    *   这样JTAG才可以访问ARM debug access port(DAP)以及 Xilinx test access port(TAP) 来分别调试ARM和PL.
*   在安全模式下，代码是被事先加密过的，BootROM会通过DMA将fsbl读到OCM中后被CPU执行。
    *   在这中间会经过AES(Advanced Encryption Standard)/HMAC(Hash-based Message Authentication Code)单元进行解密。
*   在非安全模式下，BootROM根据包头来确定是否需要将fsbl拷贝到OCM中执行。
*   如果BootROM没有在设备到找到合法的软件包头，它会依次寻找，直到找到了或遍历完这个设备空间。
    *   只会在QSPI,NAND,NOR中这样做，在SD卡中如果失败了则不会寻找了。
*   PL启动分以下4个阶段:
    *   上电启动
    *   初始化:清空SRAM，准备烧写bit文件
    *   配置: 配置PS-PL接口
    *   使能: BOOTROM会读取PL的启动状态来确定何时使能PL端的JTAG。

### PS端硬件启动

PS端硬件启动包含上电时序、时钟获取、复位、启动管脚采样、PLL初始化。在PS启动时PL也可同时启动。

在PS启动后的几个时钟周期，它将会读取MIO2~8的配置模式并将配置存储到只读存储器中。

*   其中MIO6来决定是否使能PLL，如果使能了PLL，那么系统将要等待PLL稳定后才启动BOOTROM.

如果没有使能则会直接使用外部晶振的频率。

### PS端软件启动

PS段软件上整体流程为：

1.  BootROM根据启动引脚决定从哪个介质读出BOOT包
    *   在CPU0上运行，CPU1处于等待事件状态(WFE)
    *   BootROM是硬编码的代码，无法改变
2.  BootROM分析BOOT包头来确认是否要搬移代码到OCM
3.  运行FSBL或裸机代码
    *   FSBL 是完全可更改的
4.  运行SSBL或裸机代码或系统
5.  运行系统

### 启动介质的内容

通常的启动包包含下面的内容:

*   bootrom 头，用于bootrom分析
*   fsbl/裸机代码，用于bootrom搬移
*   PL端的bit文件，用于后续代码给PL烧写
*   ssbl/裸机代码/或系统，用于fsbl跳转到此执行

### 启动模式

zynq支持4种主动启动方式：

1.  QSPI
    *   可以选择是否直接在QSPI上执行代码，这样可以减少数据搬移而提高启动速度
2.  NOR
    *   可以选择是否直接在NOR上执行代码，这样可以减少数据搬移而提高启动速度
3.  SD卡
4.  NAND

可以在[AR#50991](https://www.xilinx.com/support/answers/50991.html)中挑选官方推荐的芯片。

zynq也支持被动启动方式，这种方式是非加密模式：

*   cascade JTAG模式，默认是这种方式
    *   可以通过PL JTAG访问DAP和TAP
*   独立 JTAG模式1
    *   使用PL JTAG访问TAP来控制PL
    *   在配置完PL后，使用EMIO JTAG来访问DAP控制ARM
*   独立 JTAG模式2
    *   使用PL JTAG访问TAP来控制PL
    *   使用MIO JTAG访问DAP来控制ARM

### BootROM的执行

根据前面的说明可以知道:

1.  系统热启动的情况下会很快执行BootROM，所以其启动时间更短。
2.  BootROM在主动启动模式下，具有对应控制器的初始化功能，这样才能读取介质内容。

BootROM的头来决定是否为安全启动模式，如果为安全启动模式，BootROM会将代码从flash读出、解密、写入OCM。

*   如果安全模式下热启动，头格式被非法修改为非安全模式，此时BootROM会停止锁死系统并报错 0x201A.
    *   报错码会写入寄存器 `slcr.REBOOT_STATUS`

### PL的配置路径

[![pl_conf_path.jpg](./zynq hardware -_ boot _ explorer_files/pl_conf_path.jpg)](./zynq hardware -_ boot _ explorer_files/pl_conf_path.jpg)

如上图所示PL有3种配置路径：

1.  JTAG连接TAP控制器
    *   用于非安全模式
    *   需要PL被配置于TAP接口
2.  PS PCAP 控制
    *   用于安全和非安全模式
    *   需要PL被配置于Devc接口
3.  ICAP控制
    *   用于安全和非安全模式
    *   需要PL已经被事先下载了bit流

### 设备配置接口

[![devc_struct.jpg](./zynq hardware -_ boot _ explorer_files/devc_struct.jpg)](./zynq hardware -_ boot _ explorer_files/devc_struct.jpg)

zynq具有3个设备接口(DevC, device configuration interface)来分别:

1.  配置PL
2.  管理设备安全性
3.  访问XADC

上电到bootrom
----------

### 电源需求

在进入bootrom前，需要的电源需求如下图:

[![power_requirements.jpg](./zynq hardware -_ boot _ explorer_files/power_requirements.jpg)](./zynq hardware -_ boot _ explorer_files/power_requirements.jpg)

### 时钟

当使能PLL时，需确保外部晶振的稳定。当PLL旁路时系统运行速度会降低并且有些模块也无法使用（比如USB）。

### 复位

有以下两种复位：

*   POR Reset(冷启动复位):复位整个系统
*   Non-POR Resets(热启动复位):仅复位部分

### 启动模式管脚

[![boot_mode.jpg](./zynq hardware -_ boot _ explorer_files/boot_mode.jpg)](./zynq hardware -_ boot _ explorer_files/boot_mode.jpg)

在复位后硬件将会采样这几个管脚值，然后存储于只读寄存器:

*   BOOT\_MODE\[4:0\] 存储于 `slcr.BOOT_MODE[BOOT_MODE],[PLL_BYPASS]` 中
*   VMODE\[1:0\] 存储于 `slcr.GPIOB_DRVR_BIAS_CTRL[RB_VCFG],[LB_VCFG]` 中
    *   VMODE\[0\] 控制MIO15:0管脚，VMODE\[1\]控制53:16管脚

bootrom
-------

[![bootrom_flow.jpg](./zynq hardware -_ boot _ explorer_files/bootrom_flow.jpg)](./zynq hardware -_ boot _ explorer_files/bootrom_flow.jpg)

*   bootrom在执行期间DAP和TAP是不可用的。
*   fsbl/user code 的大小限制在192k，但如果是在flash上直接运行则没有这个限制
    *   本来256k的OCM，有高64k在运行bootrom，所以bootrom在搬移fsbl代码期间只剩下192KB空间了。

### bootrom头

bootrom头只在flash启动下需要，在JTAG启动下不需要。

![image] (https://github.com/lovecfcfxyz/Zynq-/tree/master/zynq%20hardware%20-_%20boot%20_%20explorer_files/bootrom_header1.jpg) 

![image] (https://github.com/lovecfcfxyz/Zynq-/tree/master/zynq%20hardware%20-_%20boot%20_%20explorer_files/bootrom_header2.jpg)

#### 中断向量表的存储位置(0x00 ~ 0x1c, 8个4字节)

当代码要运行在QSPI或NOR flash时，这部分空间用于存放ARM中的8种[异常中断](http://kcmetercec.top/2018/03/12/linux_kernel_irq_tutorial/#org622942e)。

#### 数据宽度检测(0x20)

当启动方式为QSPI时，此处内容必须为 `0xaa995566` 以告知bootrom可以检测数据宽度

#### 文件标识(0x24)

此处值恒定为 `0x584c4e58` 以对应字符串 "XLNX",以告知此文件为zynq的启动文件

#### 加密配置(0x28)

*   `0xa5c3c5a3` : fsbl/user code 已被加密，使用 eFUSE key
*   `0x3a5c3c5a` : fsbl/user code 已被加密，使用电源维持的 RAM key
*   其他值: 非加密模式

#### fsbl/user 定义区(0x2c)

此值可以被fsbl/user 所使用，bootrom并不使用

#### source offset(0x30)

指定源码相对文件起始位置的偏移，单位为字节。

*   此值必须是64字节对齐，并且位置不能小于 `0x8c0`

#### image长度(0x34)

指定文件长度，单位为字节。

*   当值为0时，bootrom不会拷贝代码到OCM中，而是直接在QSPI或NORflash上运行。

#### 保留(0x38)

值为0.

#### 执行的起始地址(0x3c)

指定代码的执行地址，必须64字节对齐。

#### image的总大小(0x40)

要载入OCM中的总大小。

*   在非安全模式下，此值与image长度一致
*   在安全模式下，此值会大于image长度

#### 保留(0x44)

值为0.

#### 头校验(0x48)

计算0x20~0x44之和，然后取反。

#### fsbl/user 定义区(0x4c ~ 0x9c)

此值可以被fsbl/user 所使用，bootrom并不使用

#### 寄存器初始化参数(0xa0~0x89f)

这里包含了256对 `地址，数据` 对，用于在启动fsbl/user code 之前先来初始化zynq.

*   当地址为 `0xffffffff` 或遍历到列表尾时，bootrom退出初始化

#### fsbl/user 定义区(0x8a0 ~ 0x8bf)

此值可以被fsbl/user 所使用，bootrom并不使用

#### 代码的起始地址(0x8c0)

代码地址必须存放于大于或等于此处，并且以64位对齐。

Last Updated 2018-11-12 Mon 08:04.  
Render by [hexo-renderer-org](https://github.com/CodeFalling/hexo-renderer-org) with [Emacs](https://www.gnu.org/software/emacs/) 26.1 ([Org](https://orgmode.org/) mode 9.1.14)

[\# zynq](http://kcmetercec.top/tags/zynq/)

[\[What\]数据结构与算法 -> 排序](http://kcmetercec.top/2018/11/07/program_DS_sort/ "[What]数据结构与算法 -> 排序")

[zynq petalinux -> boot](http://kcmetercec.top/2018/11/09/processor_zynq_petalinux_boot/ "zynq petalinux -> boot")

Emoji | Preview

_😀__😃__😄__😁__😆__😅__😂__😊__😇__😉__😌__😍__😘__😗__😙__😚__😋__😜__😝__😛__😎__😏__😒__😞__😔__😟__😕__😣__😖__😫__😩__😠__😡__😶__😐__😑__😯__😦__😧__😮__😲__😵__😳__😱__😨__😰__😢__😥__😭__😓__😪__😴__😷__😈__😺__😸__😹__😻__😼__😽__🙀__😿__😾__🐱__🐭__🐮__🐵__✋__✊__✌️__👆__👇__👈__👉__👊__👋__👏__👐__👍__👎__👌__🙏__👂__👀__👃__👄__👅__❤️__💘__💖__⭐️__✨__⚡️__☀️__☁️__❄️__☔️__☕️__✈️__⚓️__⌚️__☎️__⌛️__✉️__✂️__✒️__✏️__❌__♻️__✅__❎__Ⓜ️__ℹ️__™️__©️__®️_

回复

快来做第一个评论的人吧~

Powered By [Valine](https://valine.js.org/)  
v1.3.4

*   Table of Contents
*   Overview

![kcmetercec](./zynq hardware -_ boot _ explorer_files/16881795)

kcmetercec

我的世界

[160 posts](http://kcmetercec.top/archives/)

[96 categories](http://kcmetercec.top/categories/index.html)

[35 tags](http://kcmetercec.top/tags/index.html)

[RSS](http://kcmetercec.top/atom.xml)

[GitHub](https://github.com/KcMeterCEC "GitHub")

 [![Creative Commons](./zynq hardware -_ boot _ explorer_files/cc-by-nc.svg)](https://creativecommons.org/licenses/by-nc/4.0/) 

1.  [1. 整体流程](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orgc376886)
    1.  [1.1. 概览](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orga0ede36)
    2.  [1.2. PS端硬件启动](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orgb1772df)
    3.  [1.3. PS端软件启动](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orgeb46b98)
    4.  [1.4. 启动介质的内容](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orgf9d8e52)
    5.  [1.5. 启动模式](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orgca9ffa1)
    6.  [1.6. BootROM的执行](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orgf32c65e)
    7.  [1.7. PL的配置路径](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orgec9270d)
    8.  [1.8. 设备配置接口](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#org722db8d)
2.  [2. 上电到bootrom](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#org39a8c70)
    1.  [2.1. 电源需求](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#org544f181)
    2.  [2.2. 时钟](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#org7938146)
    3.  [2.3. 复位](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#org5c10aa6)
    4.  [2.4. 启动模式管脚](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orgb3da33f)
3.  [3. bootrom](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#org62e0a9c)
    1.  [3.1. bootrom头](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orge16bef2)
        1.  [3.1.1. 中断向量表的存储位置(0x00 ~ 0x1c, 8个4字节)](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#org0badeb5)
        2.  [3.1.2. 数据宽度检测(0x20)](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#org0d11179)
        3.  [3.1.3. 文件标识(0x24)](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orgaa19197)
        4.  [3.1.4. 加密配置(0x28)](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orgc1f7329)
        5.  [3.1.5. fsbl/user 定义区(0x2c)](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#org260ac76)
        6.  [3.1.6. source offset(0x30)](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orgd58c94c)
        7.  [3.1.7. image长度(0x34)](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#org9530e73)
        8.  [3.1.8. 保留(0x38)](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orgc7b6d74)
        9.  [3.1.9. 执行的起始地址(0x3c)](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orgbbcbad3)
        10.  [3.1.10. image的总大小(0x40)](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#org728c501)
        11.  [3.1.11. 保留(0x44)](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orga3fc8f1)
        12.  [3.1.12. 头校验(0x48)](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#org080336f)
        13.  [3.1.13. fsbl/user 定义区(0x4c ~ 0x9c)](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orga488f32)
        14.  [3.1.14. 寄存器初始化参数(0xa0~0x89f)](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#org7797685)
        15.  [3.1.15. fsbl/user 定义区(0x8a0 ~ 0x8bf)](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orge4d9bb7)
        16.  [3.1.16. 代码的起始地址(0x8c0)](http://kcmetercec.top/2018/11/08/processor_zynq_hd_boot/#orgcf9b01a)

© 2018 — 2019 kcmetercec | Hosted by [Coding Pages](https://pages.coding.me/)

Powered by [Hexo](https://hexo.io/)

|

Theme — [NexT.Gemini](https://github.com/iissnan/hexo-theme-next) v5.1.4

2835 4512

if (Object.prototype.toString.call(window.Promise) !== '\[object Function\]') { window.Promise = null; } var GUEST = \['nick','mail','link'\]; var guest = 'nick,mail,link'; guest = guest.split(',').filter(item=>{ return GUEST.indexOf(item)>-1; }); new Valine({ el: '#comments' , verify: false, notify: false, appId: 'HKCPHADgp5CIhX5YI6qBfUgJ-gzGzoHsz', appKey: 'z50aXrM2NQ2DbuiJsUfQMbiy', placeholder: 'Just go go', avatar:'mm', guest\_info:guest, pageSize:'10' || 10, }); // Popup Window; var isfetched = false; var isXml = true; // Search DB path; var search\_path = "search.xml"; if (search\_path.length === 0) { search\_path = "search.xml"; } else if (/json$/i.test(search\_path)) { isXml = false; } var path = "/" + search\_path; // monitor main search box; var onPopupClose = function (e) { $('.popup').hide(); $('#local-search-input').val(''); $('.search-result-list').remove(); $('#no-result').remove(); $(".local-search-pop-overlay").remove(); $('body').css('overflow', ''); } function proceedsearch() { $("body") .append('<div class="search-popup-overlay local-search-pop-overlay"></div>') .css('overflow', 'hidden'); $('.search-popup-overlay').click(onPopupClose); $('.popup').toggle(); var $localSearchInput = $('#local-search-input'); $localSearchInput.attr("autocapitalize", "none"); $localSearchInput.attr("autocorrect", "off"); $localSearchInput.focus(); } // search function; var searchFunc = function(path, search\_id, content\_id) { 'use strict'; // start loading animation $("body") .append('<div class="search-popup-overlay local-search-pop-overlay">' + '<div id="search-loading-icon">' + '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' + '</div>' + '</div>') .css('overflow', 'hidden'); $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center'); $.ajax({ url: path, dataType: isXml ? "xml" : "json", async: true, success: function(res) { // get the contents from search data isfetched = true; $('.popup').detach().appendTo('.header-inner'); var datas = isXml ? $("entry", res).map(function() { return { title: $("title", this).text(), content: $("content",this).text(), url: $("url" , this).text() }; }).get() : res; var input = document.getElementById(search\_id); var resultContent = document.getElementById(content\_id); var inputEventFunction = function() { var searchText = input.value.trim().toLowerCase(); var keywords = searchText.split(/\[\\s\\-\]+/); if (keywords.length > 1) { keywords.push(searchText); } var resultItems = \[\]; if (searchText.length > 0) { // perform local searching datas.forEach(function(data) { var isMatch = false; var hitCount = 0; var searchTextCount = 0; var title = data.title.trim(); var titleInLowerCase = title.toLowerCase(); var content = data.content.trim().replace(/<\[^>\]+>/g,""); var contentInLowerCase = content.toLowerCase(); var articleUrl = decodeURIComponent(data.url); var indexOfTitle = \[\]; var indexOfContent = \[\]; // only match articles with not empty titles if(title != '') { keywords.forEach(function(keyword) { function getIndexByWord(word, text, caseSensitive) { var wordLen = word.length; if (wordLen === 0) { return \[\]; } var startPosition = 0, position = \[\], index = \[\]; if (!caseSensitive) { text = text.toLowerCase(); word = word.toLowerCase(); } while ((position = text.indexOf(word, startPosition)) > -1) { index.push({position: position, word: word}); startPosition = position + wordLen; } return index; } indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false)); indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false)); }); if (indexOfTitle.length > 0 || indexOfContent.length > 0) { isMatch = true; hitCount = indexOfTitle.length + indexOfContent.length; } } // show search results if (isMatch) { // sort index by position of keyword \[indexOfTitle, indexOfContent\].forEach(function (index) { index.sort(function (itemLeft, itemRight) { if (itemRight.position !== itemLeft.position) { return itemRight.position - itemLeft.position; } else { return itemLeft.word.length - itemRight.word.length; } }); }); // merge hits into slices function mergeIntoSlice(text, start, end, index) { var item = index\[index.length - 1\]; var position = item.position; var word = item.word; var hits = \[\]; var searchTextCountInSlice = 0; while (position + word.length <= end && index.length != 0) { if (word === searchText) { searchTextCountInSlice++; } hits.push({position: position, length: word.length}); var wordEnd = position + word.length; // move to next position of hit index.pop(); while (index.length != 0) { item = index\[index.length - 1\]; position = item.position; word = item.word; if (wordEnd > position) { index.pop(); } else { break; } } } searchTextCount += searchTextCountInSlice; return { hits: hits, start: start, end: end, searchTextCount: searchTextCountInSlice }; } var slicesOfTitle = \[\]; if (indexOfTitle.length != 0) { slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle)); } var slicesOfContent = \[\]; while (indexOfContent.length != 0) { var item = indexOfContent\[indexOfContent.length - 1\]; var position = item.position; var word = item.word; // cut out 100 characters var start = position - 20; var end = position + 80; if(start < 0){ start = 0; } if (end < position + word.length) { end = position + word.length; } if(end > content.length){ end = content.length; } slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent)); } // sort slices in content by search text's count and hits' count slicesOfContent.sort(function (sliceLeft, sliceRight) { if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) { return sliceRight.searchTextCount - sliceLeft.searchTextCount; } else if (sliceLeft.hits.length !== sliceRight.hits.length) { return sliceRight.hits.length - sliceLeft.hits.length; } else { return sliceLeft.start - sliceRight.start; } }); // select top N slices in content var upperBound = parseInt('1'); if (upperBound >= 0) { slicesOfContent = slicesOfContent.slice(0, upperBound); } // highlight title and content function highlightKeyword(text, slice) { var result = ''; var prevEnd = slice.start; slice.hits.forEach(function (hit) { result += text.substring(prevEnd, hit.position); var end = hit.position + hit.length; result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>'; prevEnd = end; }); result += text.substring(prevEnd, slice.end); return result; } var resultItem = ''; if (slicesOfTitle.length != 0) { resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle\[0\]) + "</a>"; } else { resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>"; } slicesOfContent.forEach(function (slice) { resultItem += "<a href='" + articleUrl + "'>" + "<p class=\\"search-result\\">" + highlightKeyword(content, slice) + "...</p>" + "</a>"; }); resultItem += "</li>"; resultItems.push({ item: resultItem, searchTextCount: searchTextCount, hitCount: hitCount, id: resultItems.length }); } }) }; if (keywords.length === 1 && keywords\[0\] === "") { resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' } else if (resultItems.length === 0) { resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' } else { resultItems.sort(function (resultLeft, resultRight) { if (resultLeft.searchTextCount !== resultRight.searchTextCount) { return resultRight.searchTextCount - resultLeft.searchTextCount; } else if (resultLeft.hitCount !== resultRight.hitCount) { return resultRight.hitCount - resultLeft.hitCount; } else { return resultRight.id - resultLeft.id; } }); var searchResultList = '<ul class=\\"search-result-list\\">'; resultItems.forEach(function (result) { searchResultList += result.item; }) searchResultList += "</ul>"; resultContent.innerHTML = searchResultList; } } if ('auto' === 'auto') { input.addEventListener('input', inputEventFunction); } else { $('.search-icon').click(inputEventFunction); input.addEventListener('keypress', function (event) { if (event.keyCode === 13) { inputEventFunction(); } }); } // remove loading animation $(".local-search-pop-overlay").remove(); $('body').css('overflow', ''); proceedsearch(); } }); } // handle and trigger popup window; $('.popup-trigger').click(function(e) { e.stopPropagation(); if (isfetched === false) { searchFunc(path, 'local-search-input', 'local-search-result'); } else { proceedsearch(); }; }); $('.popup-btn-close').click(onPopupClose); $('.popup').click(function(e){ e.stopPropagation(); }); $(document).on('keyup', function (event) { var shouldDismissSearchPopup = event.which === 27 && $('.search-popup').is(':visible'); if (shouldDismissSearchPopup) { onPopupClose(); } }); AV.initialize("HKCPHADgp5CIhX5YI6qBfUgJ-gzGzoHsz", "z50aXrM2NQ2DbuiJsUfQMbiy"); function showTime(Counter) { var query = new AV.Query(Counter); var entries = \[\]; var $visitors = $(".leancloud\_visitors"); $visitors.each(function () { entries.push( $(this).attr("id").trim() ); }); query.containedIn('url', entries); query.find() .done(function (results) { var COUNT\_CONTAINER\_REF = '.leancloud-visitors-count'; if (results.length === 0) { $visitors.find(COUNT\_CONTAINER\_REF).text(0); return; } for (var i = 0; i < results.length; i++) { var item = results\[i\]; var url = item.get('url'); var time = item.get('time'); var element = document.getElementById(url); $(element).find(COUNT\_CONTAINER\_REF).text(time); } for(var i = 0; i < entries.length; i++) { var url = entries\[i\]; var element = document.getElementById(url); var countSpan = $(element).find(COUNT\_CONTAINER\_REF); if( countSpan.text() == '') { countSpan.text(0); } } }) .fail(function (object, error) { console.log("Error: " + error.code + " " + error.message); }); } function addCount(Counter) { var $visitors = $(".leancloud\_visitors"); var url = $visitors.attr('id').trim(); var title = $visitors.attr('data-flag-title').trim(); var query = new AV.Query(Counter); query.equalTo("url", url); query.find({ success: function(results) { if (results.length > 0) { var counter = results\[0\]; counter.fetchWhenSave(true); counter.increment("time"); counter.save(null, { success: function(counter) { var $element = $(document.getElementById(url)); $element.find('.leancloud-visitors-count').text(counter.get('time')); }, error: function(counter, error) { console.log('Failed to save Visitor num, with error message: ' + error.message); } }); } else { var newcounter = new Counter(); /\* Set ACL \*/ var acl = new AV.ACL(); acl.setPublicReadAccess(true); acl.setPublicWriteAccess(true); newcounter.setACL(acl); /\* End Set ACL \*/ newcounter.set("title", title); newcounter.set("url", url); newcounter.set("time", 1); newcounter.save(null, { success: function(newcounter) { var $element = $(document.getElementById(url)); $element.find('.leancloud-visitors-count').text(newcounter.get('time')); }, error: function(newcounter, error) { console.log('Failed to create'); } }); } }, error: function(error) { console.log('Error:' + error.code + " " + error.message); } }); } $(function() { var Counter = AV.Object.extend("Counter"); if ($('.leancloud\_visitors').length == 1) { addCount(Counter); } else if ($('.post-title-link').length > 1) { showTime(Counter); } });
